# Hydra GCP Performance Benchmarks _(token strategy=jwt, database=memory)_

In this document you will find benchmark results for different endpoints of ORY Hydra. All benchmarks are executed
using [rakyll/hey](https://github.com/rakyll/hey). Please note that these benchmarks run against the memory storage
adapter.

Please note performance may greatly differs between deployments (e.g. request latency, database configuration) and
tweaking individual things may greatly improve performance. This is also not indicative of long-term performance as
database sizes grow. Take these results with a very large grain of salt.

All benchmarks run 10,000 requests in total, with 100 concurrent requests. All benchmarks run on a n1-highcpu-4
Compute Engine VM (4 vCPUs, 3.6GB memory) in the us-east1-b zone on Google Compute Engine. To provide enough entropy
for random number generation, haveged was installed and setup on the test machine. Where applicable, the
n1-standard-2 (2 vCPUs, 7.5 GB memory) machine type is used for the PostgreSQL instance using Google Cloud SQL
running in the same zone.

## BCrypt

ORY Hydra uses BCrypt to obfuscate secrets of OAuth 2.0 Clients. When using flows such as the OAuth 2.0 Client Credentials
Grant, ORY Hydra validates the client credentials using BCrypt which causes (by design) CPU load. CPU load and performance
depend on the BCrypt cost which can be set using the environment variable `BCRYPT_COST`. For these benchmarks,
we have set `BCRYPT_COST=8`.

## OAuth 2.0

This section contains various benchmarks against OAuth 2.0 endpoints

### Token Introspection

```

Summary:
  Total:	2.7781 secs
  Slowest:	0.0774 secs
  Fastest:	0.0005 secs
  Average:	0.0268 secs
  Requests/sec:	3599.6041
  
  Total data:	1890000 bytes
  Size/request:	189 bytes

Response time histogram:
  0.001 [1]	|
  0.008 [1506]	|■■■■■■■■■■■■■■■
  0.016 [424]	|■■■■
  0.024 [683]	|■■■■■■■
  0.031 [4101]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.039 [2040]	|■■■■■■■■■■■■■■■■■■■■
  0.047 [755]	|■■■■■■■
  0.054 [286]	|■■■
  0.062 [160]	|■■
  0.070 [28]	|
  0.077 [16]	|


Latency distribution:
  10% in 0.0030 secs
  25% in 0.0223 secs
  50% in 0.0289 secs
  75% in 0.0332 secs
  90% in 0.0407 secs
  95% in 0.0464 secs
  99% in 0.0591 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0005 secs, 0.0774 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0215 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0200 secs
  resp wait:	0.0265 secs, 0.0005 secs, 0.0773 secs
  resp read:	0.0001 secs, 0.0000 secs, 0.0125 secs

Status code distribution:
  [200]	10000 responses



```

### Client Credentials Grant

This endpoint uses [BCrypt](#bcrypt).

```

Summary:
  Total:	308.2032 secs
  Slowest:	5.0826 secs
  Fastest:	0.0747 secs
  Average:	3.0590 secs
  Requests/sec:	32.4461
  
  Total data:	11170000 bytes
  Size/request:	1117 bytes

Response time histogram:
  0.075 [1]	|
  0.575 [7]	|
  1.076 [25]	|
  1.577 [22]	|
  2.078 [113]	|■
  2.579 [1130]	|■■■■■■■■■■■
  3.079 [3956]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  3.580 [3509]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  4.081 [1054]	|■■■■■■■■■■■
  4.582 [163]	|■■
  5.083 [20]	|


Latency distribution:
  10% in 2.5106 secs
  25% in 2.7607 secs
  50% in 3.0502 secs
  75% in 3.3518 secs
  90% in 3.6418 secs
  95% in 3.8286 secs
  99% in 4.2162 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0001 secs, 0.0747 secs, 5.0826 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0195 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0179 secs
  resp wait:	3.0588 secs, 0.0745 secs, 5.0824 secs
  resp read:	0.0001 secs, 0.0000 secs, 0.0057 secs

Status code distribution:
  [200]	10000 responses



```

## OAuth 2.0 Client Management

### Creating OAuth 2.0 Clients

This endpoint uses [BCrypt](#bcrypt) and generates IDs and secrets by reading from  which negatively impacts
performance. Performance will be better if IDs and secrets are set in the request as opposed to generated by Hydra GCP.

```
This test is currently disabled due to issues with /dev/urandom being inaccessible in the CI.
```

### Listing OAuth 2.0 Clients

```

Summary:
  Total:	0.6340 secs
  Slowest:	0.0574 secs
  Fastest:	0.0001 secs
  Average:	0.0057 secs
  Requests/sec:	15773.5506
  
  Total data:	4210000 bytes
  Size/request:	421 bytes

Response time histogram:
  0.000 [1]	|
  0.006 [6560]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.012 [1620]	|■■■■■■■■■■
  0.017 [979]	|■■■■■■
  0.023 [497]	|■■■
  0.029 [217]	|■
  0.034 [68]	|
  0.040 [35]	|
  0.046 [21]	|
  0.052 [1]	|
  0.057 [1]	|


Latency distribution:
  10% in 0.0003 secs
  25% in 0.0005 secs
  50% in 0.0022 secs
  75% in 0.0089 secs
  90% in 0.0163 secs
  95% in 0.0206 secs
  99% in 0.0304 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0001 secs, 0.0574 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0114 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0082 secs
  resp wait:	0.0054 secs, 0.0001 secs, 0.0573 secs
  resp read:	0.0002 secs, 0.0000 secs, 0.0084 secs

Status code distribution:
  [200]	10000 responses



```

### Fetching a specific OAuth 2.0 Client

```

Summary:
  Total:	0.5928 secs
  Slowest:	0.0541 secs
  Fastest:	0.0001 secs
  Average:	0.0053 secs
  Requests/sec:	16870.5156
  
  Total data:	4190000 bytes
  Size/request:	419 bytes

Response time histogram:
  0.000 [1]	|
  0.005 [6490]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.011 [1749]	|■■■■■■■■■■■
  0.016 [956]	|■■■■■■
  0.022 [512]	|■■■
  0.027 [180]	|■
  0.032 [71]	|
  0.038 [24]	|
  0.043 [8]	|
  0.049 [6]	|
  0.054 [3]	|


Latency distribution:
  10% in 0.0002 secs
  25% in 0.0005 secs
  50% in 0.0020 secs
  75% in 0.0089 secs
  90% in 0.0152 secs
  95% in 0.0187 secs
  99% in 0.0275 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0001 secs, 0.0541 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0117 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0139 secs
  resp wait:	0.0050 secs, 0.0001 secs, 0.0540 secs
  resp read:	0.0002 secs, 0.0000 secs, 0.0160 secs

Status code distribution:
  [200]	10000 responses



```
