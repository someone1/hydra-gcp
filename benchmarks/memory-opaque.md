# Hydra GCP Performance Benchmarks _(token strategy=opaque, database=memory)_

In this document you will find benchmark results for different endpoints of ORY Hydra. All benchmarks are executed
using [rakyll/hey](https://github.com/rakyll/hey). Please note that these benchmarks run against the memory storage
adapter.

Please note performance may greatly differs between deployments (e.g. request latency, database configuration) and
tweaking individual things may greatly improve performance. This is also not indicative of long-term performance as
database sizes grow. Take these results with a very large grain of salt.

All benchmarks run 10,000 requests in total, with 100 concurrent requests. All benchmarks run on a n1-highcpu-4
Compute Engine VM (4 vCPUs, 3.6GB memory) in the us-east1-b zone on Google Compute Engine. To provide enough entropy
for random number generation, haveged was installed and setup on the test machine. Where applicable, the
n1-standard-2 (2 vCPUs, 7.5 GB memory) machine type is used for the PostgreSQL instance using Google Cloud SQL
running in the same zone.

## BCrypt

ORY Hydra uses BCrypt to obfuscate secrets of OAuth 2.0 Clients. When using flows such as the OAuth 2.0 Client Credentials
Grant, ORY Hydra validates the client credentials using BCrypt which causes (by design) CPU load. CPU load and performance
depend on the BCrypt cost which can be set using the environment variable `BCRYPT_COST`. For these benchmarks,
we have set `BCRYPT_COST=8`.

## OAuth 2.0

This section contains various benchmarks against OAuth 2.0 endpoints

### Token Introspection

```

Summary:
  Total:	0.7976 secs
  Slowest:	0.0454 secs
  Fastest:	0.0001 secs
  Average:	0.0075 secs
  Requests/sec:	12537.0643
  
  Total data:	1550000 bytes
  Size/request:	155 bytes

Response time histogram:
  0.000 [1]	|
  0.005 [4107]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.009 [1775]	|■■■■■■■■■■■■■■■■■
  0.014 [2541]	|■■■■■■■■■■■■■■■■■■■■■■■■■
  0.018 [1090]	|■■■■■■■■■■■
  0.023 [330]	|■■■
  0.027 [124]	|■
  0.032 [24]	|
  0.036 [4]	|
  0.041 [2]	|
  0.045 [2]	|


Latency distribution:
  10% in 0.0005 secs
  25% in 0.0015 secs
  50% in 0.0068 secs
  75% in 0.0121 secs
  90% in 0.0154 secs
  95% in 0.0181 secs
  99% in 0.0245 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0001 secs, 0.0454 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0137 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0113 secs
  resp wait:	0.0073 secs, 0.0001 secs, 0.0377 secs
  resp read:	0.0001 secs, 0.0000 secs, 0.0094 secs

Status code distribution:
  [200]	10000 responses



```

### Client Credentials Grant

This endpoint uses [BCrypt](#bcrypt).

```

Summary:
  Total:	60.4478 secs
  Slowest:	2.2866 secs
  Fastest:	0.0233 secs
  Average:	0.5915 secs
  Requests/sec:	165.4321
  
  Total data:	1570000 bytes
  Size/request:	157 bytes

Response time histogram:
  0.023 [1]	|
  0.250 [473]	|■■■
  0.476 [969]	|■■■■■
  0.702 [7394]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.929 [823]	|■■■■
  1.155 [195]	|■
  1.381 [76]	|
  1.608 [34]	|
  1.834 [12]	|
  2.060 [15]	|
  2.287 [8]	|


Latency distribution:
  10% in 0.3678 secs
  25% in 0.5820 secs
  50% in 0.5962 secs
  75% in 0.6217 secs
  90% in 0.7181 secs
  95% in 0.8478 secs
  99% in 1.3599 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0001 secs, 0.0233 secs, 2.2866 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0217 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0172 secs
  resp wait:	0.5912 secs, 0.0224 secs, 2.2865 secs
  resp read:	0.0000 secs, 0.0000 secs, 0.0061 secs

Status code distribution:
  [200]	10000 responses



```

## OAuth 2.0 Client Management

### Creating OAuth 2.0 Clients

This endpoint uses [BCrypt](#bcrypt) and generates IDs and secrets by reading from  which negatively impacts
performance. Performance will be better if IDs and secrets are set in the request as opposed to generated by Hydra GCP.

```
This test is currently disabled due to issues with /dev/urandom being inaccessible in the CI.
```

### Listing OAuth 2.0 Clients

```

Summary:
  Total:	0.6686 secs
  Slowest:	0.0699 secs
  Fastest:	0.0001 secs
  Average:	0.0062 secs
  Requests/sec:	14956.6835
  
  Total data:	4210000 bytes
  Size/request:	421 bytes

Response time histogram:
  0.000 [1]	|
  0.007 [6886]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.014 [1777]	|■■■■■■■■■■
  0.021 [785]	|■■■■■
  0.028 [308]	|■■
  0.035 [165]	|■
  0.042 [62]	|
  0.049 [15]	|
  0.056 [0]	|
  0.063 [0]	|
  0.070 [1]	|


Latency distribution:
  10% in 0.0003 secs
  25% in 0.0008 secs
  50% in 0.0031 secs
  75% in 0.0090 secs
  90% in 0.0164 secs
  95% in 0.0218 secs
  99% in 0.0336 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0001 secs, 0.0699 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0096 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0206 secs
  resp wait:	0.0053 secs, 0.0001 secs, 0.0608 secs
  resp read:	0.0005 secs, 0.0000 secs, 0.0277 secs

Status code distribution:
  [200]	10000 responses



```

### Fetching a specific OAuth 2.0 Client

```

Summary:
  Total:	0.6558 secs
  Slowest:	0.0546 secs
  Fastest:	0.0001 secs
  Average:	0.0060 secs
  Requests/sec:	15249.4351
  
  Total data:	4190000 bytes
  Size/request:	419 bytes

Response time histogram:
  0.000 [1]	|
  0.006 [6324]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.011 [1561]	|■■■■■■■■■■
  0.016 [1026]	|■■■■■■
  0.022 [680]	|■■■■
  0.027 [261]	|■■
  0.033 [81]	|■
  0.038 [38]	|
  0.044 [17]	|
  0.049 [8]	|
  0.055 [3]	|


Latency distribution:
  10% in 0.0003 secs
  25% in 0.0006 secs
  50% in 0.0026 secs
  75% in 0.0094 secs
  90% in 0.0169 secs
  95% in 0.0209 secs
  99% in 0.0306 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0001 secs, 0.0546 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0102 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0110 secs
  resp wait:	0.0055 secs, 0.0001 secs, 0.0545 secs
  resp read:	0.0004 secs, 0.0000 secs, 0.0269 secs

Status code distribution:
  [200]	10000 responses



```
