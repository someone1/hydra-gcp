# Hydra GCP Performance Benchmarks _(token strategy=iam, database=memory)_

In this document you will find benchmark results for different endpoints of Hydra GCP. All benchmarks are executed
using [rakyll/hey](https://github.com/rakyll/hey). Please note that these benchmarks run against the memory storage
adapter.

Please note performance may greatly differs between deployments (e.g. request latency, database configuration) and
tweaking individual things may greatly improve performance. This is also not indicative of long-term performance as
database sizes grow. Take these results with a very large grain of salt.

All benchmarks run 10,000 requests in total, with 100 concurrent requests. All benchmarks run on a n1-highcpu-4
Compute Engine VM (4 vCPUs, 3.6GB memory) in the us-east1-b zone on Google Compute Engine. To provide enough entropy
for random number generation, haveged was installed and setup on the test machine. Where applicable, the
n1-standard-2 (2 vCPUs, 7.5 GB memory) machine type is used for the PostgreSQL instance using Google Cloud SQL
running in the same zone.

## BCrypt

Hydra GCP uses BCrypt to obfuscate secrets of OAuth 2.0 Clients. When using flows such as the OAuth 2.0 Client Credentials
Grant, Hydra GCP validates the client credentials using BCrypt which causes (by design) CPU load. CPU load and performance
depend on the BCrypt cost which can be set using the environment variable `BCRYPT_COST`. For these benchmarks,
we have set `BCRYPT_COST=8`.

## OAuth 2.0

This section contains various benchmarks against OAuth 2.0 endpoints

### Token Introspection

```

Summary:
  Total:	3.8803 secs
  Slowest:	0.1208 secs
  Fastest:	0.0054 secs
  Average:	0.0385 secs
  Requests/sec:	2577.1169
  
  Total data:	1680000 bytes
  Size/request:	168 bytes

Response time histogram:
  0.005 [1]	|
  0.017 [34]	|
  0.028 [253]	|■■
  0.040 [6584]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.052 [2874]	|■■■■■■■■■■■■■■■■■
  0.063 [159]	|■
  0.075 [35]	|
  0.086 [27]	|
  0.098 [7]	|
  0.109 [13]	|
  0.121 [13]	|


Latency distribution:
  10% in 0.0323 secs
  25% in 0.0352 secs
  50% in 0.0380 secs
  75% in 0.0408 secs
  90% in 0.0443 secs
  95% in 0.0473 secs
  99% in 0.0617 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0054 secs, 0.1208 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0062 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0091 secs
  resp wait:	0.0383 secs, 0.0053 secs, 0.1187 secs
  resp read:	0.0001 secs, 0.0000 secs, 0.0145 secs

Status code distribution:
  [200]	10000 responses



```

### Client Credentials Grant

This endpoint uses [BCrypt](#bcrypt).

```

Summary:
  Total:	75.7986 secs
  Slowest:	1.6324 secs
  Fastest:	0.1519 secs
  Average:	0.7455 secs
  Requests/sec:	131.9286
  
  Total data:	7430000 bytes
  Size/request:	743 bytes

Response time histogram:
  0.152 [1]	|
  0.300 [72]	|■
  0.448 [410]	|■■■■■
  0.596 [1231]	|■■■■■■■■■■■■■■■
  0.744 [3168]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.892 [3373]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  1.040 [1231]	|■■■■■■■■■■■■■■■
  1.188 [413]	|■■■■■
  1.336 [76]	|■
  1.484 [23]	|
  1.632 [2]	|


Latency distribution:
  10% in 0.5300 secs
  25% in 0.6471 secs
  50% in 0.7471 secs
  75% in 0.8378 secs
  90% in 0.9570 secs
  95% in 1.0458 secs
  99% in 1.1899 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0002 secs, 0.1519 secs, 1.6324 secs
  DNS-lookup:	0.0001 secs, 0.0000 secs, 0.0116 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0138 secs
  resp wait:	0.7451 secs, 0.1517 secs, 1.6323 secs
  resp read:	0.0001 secs, 0.0000 secs, 0.0116 secs

Status code distribution:
  [200]	10000 responses



```

## OAuth 2.0 Client Management

### Creating OAuth 2.0 Clients

This endpoint uses [BCrypt](#bcrypt) and generates IDs and secrets by reading from  which negatively impacts
performance. Performance will be better if IDs and secrets are set in the request as opposed to generated by Hydra GCP.

```
This test is currently disabled due to issues with /dev/urandom being inaccessible in the CI.
```

### Listing OAuth 2.0 Clients

```

Summary:
  Total:	0.4592 secs
  Slowest:	0.0483 secs
  Fastest:	0.0001 secs
  Average:	0.0044 secs
  Requests/sec:	21775.0356
  
  Total data:	4210000 bytes
  Size/request:	421 bytes

Response time histogram:
  0.000 [1]	|
  0.005 [7480]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.010 [1849]	|■■■■■■■■■■
  0.015 [401]	|■■
  0.019 [65]	|
  0.024 [86]	|
  0.029 [44]	|
  0.034 [21]	|
  0.039 [17]	|
  0.044 [31]	|
  0.048 [5]	|


Latency distribution:
  10% in 0.0011 secs
  25% in 0.0020 secs
  50% in 0.0033 secs
  75% in 0.0050 secs
  90% in 0.0085 secs
  95% in 0.0110 secs
  99% in 0.0260 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0001 secs, 0.0483 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0255 secs
  req write:	0.0001 secs, 0.0000 secs, 0.0230 secs
  resp wait:	0.0036 secs, 0.0001 secs, 0.0405 secs
  resp read:	0.0004 secs, 0.0000 secs, 0.0350 secs

Status code distribution:
  [200]	10000 responses



```

### Fetching a specific OAuth 2.0 Client

```

Summary:
  Total:	0.4232 secs
  Slowest:	0.0357 secs
  Fastest:	0.0001 secs
  Average:	0.0041 secs
  Requests/sec:	23627.8570
  
  Total data:	4190000 bytes
  Size/request:	419 bytes

Response time histogram:
  0.000 [1]	|
  0.004 [5554]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.007 [3231]	|■■■■■■■■■■■■■■■■■■■■■■■
  0.011 [903]	|■■■■■■■
  0.014 [153]	|■
  0.018 [46]	|
  0.021 [40]	|
  0.025 [59]	|
  0.029 [7]	|
  0.032 [0]	|
  0.036 [6]	|


Latency distribution:
  10% in 0.0012 secs
  25% in 0.0020 secs
  50% in 0.0033 secs
  75% in 0.0051 secs
  90% in 0.0077 secs
  95% in 0.0097 secs
  99% in 0.0189 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0001 secs, 0.0357 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0146 secs
  req write:	0.0001 secs, 0.0000 secs, 0.0178 secs
  resp wait:	0.0033 secs, 0.0001 secs, 0.0293 secs
  resp read:	0.0005 secs, 0.0000 secs, 0.0171 secs

Status code distribution:
  [200]	10000 responses



```
