# Hydra GCP Performance Benchmarks _(token strategy=iam, database=datastore)_

In this document you will find benchmark results for different endpoints of Hydra GCP. All benchmarks are executed
using [rakyll/hey](https://github.com/rakyll/hey). Please note that these benchmarks run against the datastore storage
adapter.

Please note performance may greatly differs between deployments (e.g. request latency, database configuration) and
tweaking individual things may greatly improve performance. This is also not indicative of long-term performance as
database sizes grow. Take these results with a very large grain of salt.

All benchmarks run 10,000 requests in total, with 100 concurrent requests. All benchmarks run on a n1-highcpu-4
Compute Engine VM (4 vCPUs, 3.6GB memory) in the us-east1-b zone on Google Compute Engine. To provide enough entropy
for random number generation, haveged was installed and setup on the test machine. Where applicable, the
n1-standard-2 (2 vCPUs, 7.5 GB memory) machine type is used for the PostgreSQL instance using Google Cloud SQL
running in the same zone.

## BCrypt

Hydra GCP uses BCrypt to obfuscate secrets of OAuth 2.0 Clients. When using flows such as the OAuth 2.0 Client Credentials
Grant, Hydra GCP validates the client credentials using BCrypt which causes (by design) CPU load. CPU load and performance
depend on the BCrypt cost which can be set using the environment variable `BCRYPT_COST`. For these benchmarks,
we have set `BCRYPT_COST=8`.

## OAuth 2.0

This section contains various benchmarks against OAuth 2.0 endpoints

### Token Introspection

```

Summary:
  Total:	10.6265 secs
  Slowest:	0.3827 secs
  Fastest:	0.0786 secs
  Average:	0.1015 secs
  Requests/sec:	941.0461
  
  Total data:	1680000 bytes
  Size/request:	168 bytes

Response time histogram:
  0.079 [1]	|
  0.109 [8381]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.139 [1014]	|■■■■■
  0.170 [231]	|■
  0.200 [189]	|■
  0.231 [81]	|
  0.261 [49]	|
  0.292 [45]	|
  0.322 [5]	|
  0.352 [3]	|
  0.383 [1]	|


Latency distribution:
  10% in 0.0856 secs
  25% in 0.0886 secs
  50% in 0.0938 secs
  75% in 0.1029 secs
  90% in 0.1186 secs
  95% in 0.1522 secs
  99% in 0.2339 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0786 secs, 0.3827 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0035 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0146 secs
  resp wait:	0.1013 secs, 0.0784 secs, 0.3790 secs
  resp read:	0.0001 secs, 0.0000 secs, 0.0077 secs

Status code distribution:
  [200]	10000 responses



```

### Client Credentials Grant

This endpoint uses [BCrypt](#bcrypt).

```

Summary:
  Total:	78.3097 secs
  Slowest:	2.8345 secs
  Fastest:	0.2718 secs
  Average:	0.7687 secs
  Requests/sec:	127.6981
  
  Total data:	7430000 bytes
  Size/request:	743 bytes

Response time histogram:
  0.272 [1]	|
  0.528 [437]	|■■■
  0.784 [5363]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  1.041 [3701]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  1.297 [473]	|■■■■
  1.553 [21]	|
  1.809 [3]	|
  2.066 [0]	|
  2.322 [0]	|
  2.578 [0]	|
  2.835 [1]	|


Latency distribution:
  10% in 0.5854 secs
  25% in 0.6662 secs
  50% in 0.7569 secs
  75% in 0.8590 secs
  90% in 0.9742 secs
  95% in 1.0403 secs
  99% in 1.1914 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.2718 secs, 2.8345 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0095 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0134 secs
  resp wait:	0.7686 secs, 0.2717 secs, 2.8345 secs
  resp read:	0.0001 secs, 0.0000 secs, 0.0081 secs

Status code distribution:
  [200]	10000 responses



```

## OAuth 2.0 Client Management

### Creating OAuth 2.0 Clients

This endpoint uses [BCrypt](#bcrypt) and generates IDs and secrets by reading from  which negatively impacts
performance. Performance will be better if IDs and secrets are set in the request as opposed to generated by Hydra GCP.

```
This test is currently disabled due to issues with /dev/urandom being inaccessible in the CI.
```

### Listing OAuth 2.0 Clients

```

Summary:
  Total:	5.4690 secs
  Slowest:	0.2372 secs
  Fastest:	0.0366 secs
  Average:	0.0490 secs
  Requests/sec:	1828.4739
  
  Total data:	4150000 bytes
  Size/request:	415 bytes

Response time histogram:
  0.037 [1]	|
  0.057 [9028]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.077 [649]	|■■■
  0.097 [73]	|
  0.117 [94]	|
  0.137 [71]	|
  0.157 [53]	|
  0.177 [16]	|
  0.197 [9]	|
  0.217 [4]	|
  0.237 [2]	|


Latency distribution:
  10% in 0.0401 secs
  25% in 0.0421 secs
  50% in 0.0457 secs
  75% in 0.0503 secs
  90% in 0.0564 secs
  95% in 0.0644 secs
  99% in 0.1308 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0366 secs, 0.2372 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0068 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0067 secs
  resp wait:	0.0488 secs, 0.0365 secs, 0.2371 secs
  resp read:	0.0000 secs, 0.0000 secs, 0.0028 secs

Status code distribution:
  [200]	10000 responses



```

### Fetching a specific OAuth 2.0 Client

```

Summary:
  Total:	5.1392 secs
  Slowest:	0.2723 secs
  Fastest:	0.0362 secs
  Average:	0.0485 secs
  Requests/sec:	1945.8367
  
  Total data:	4130000 bytes
  Size/request:	413 bytes

Response time histogram:
  0.036 [1]	|
  0.060 [9440]	|■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
  0.083 [296]	|■
  0.107 [96]	|
  0.131 [81]	|
  0.154 [45]	|
  0.178 [27]	|
  0.201 [9]	|
  0.225 [2]	|
  0.249 [1]	|
  0.272 [2]	|


Latency distribution:
  10% in 0.0393 secs
  25% in 0.0416 secs
  50% in 0.0460 secs
  75% in 0.0505 secs
  90% in 0.0546 secs
  95% in 0.0620 secs
  99% in 0.1255 secs

Details (average, fastest, slowest):
  DNS+dialup:	0.0000 secs, 0.0362 secs, 0.2723 secs
  DNS-lookup:	0.0000 secs, 0.0000 secs, 0.0052 secs
  req write:	0.0000 secs, 0.0000 secs, 0.0043 secs
  resp wait:	0.0483 secs, 0.0362 secs, 0.2722 secs
  resp read:	0.0000 secs, 0.0000 secs, 0.0021 secs

Status code distribution:
  [200]	10000 responses



```
